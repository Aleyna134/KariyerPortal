@model KariyerPortal.Models.JobListResponse
@using Microsoft.AspNetCore.Identity
@inject UserManager<AppUser> UserManager
@inject SignInManager<AppUser> SignInManager
@using KariyerPortal.Context
@inject ApplicationDbContext DbContext

@{
    ViewData["Title"] = "İlan Detayı";

    bool hasApplied = false;
    if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);
        hasApplied = DbContext.JobApplications.Any(a => a.JobId == Model.Id && a.UserId == user.Id);
    }
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success mt-3">@TempData["Message"]</div>
}

<div class="card my-4 shadow-sm">
    <div class="card-header bg-info text-white">
        <h4 class="mb-0">@Model.Title</h4>
    </div>
    <div class="card-body">
        <p class="card-text">@Model.Description</p>
        <p class="card-text text-muted">
            <small>Yayınlanma: @Model.Created.ToShortDateString()</small><br />
            <small>İlan Sahibi: @Model.CreatedBy</small>
        </p>

        <div class="text-end mt-4">
            @if (SignInManager.IsSignedIn(User))
            {
                if (hasApplied)
                {
                    <span class="badge bg-secondary p-2 mt-1 d-inline-block">Başvuruldu</span>
                }
                else
                {
                    <a asp-controller="Job" asp-action="Apply" asp-route-id="@Model.Id" class="btn btn-primary">
                        Başvur
                    </a>
                }
            }
            else
            {
                <a asp-controller="Auth" asp-action="Login" class="btn btn-outline-primary">
                    Giriş Yaparak Başvur
                </a>
            }
        </div>

        <a asp-action="List" class="btn btn-link mt-3">← Geri Dön</a>
    </div>
</div>